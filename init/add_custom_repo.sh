#!/bin/bash

set -e

pacman-key --init

KEYFILE=$(mktemp)
cat >"${KEYFILE}" <<EOF
-----BEGIN PGP PUBLIC KEY BLOCK-----

mQINBGhrCUgBEAC2qEDz0ZFKMBLWV/OGyKxOuHnx99wxL5DOivKEZU0z6NDZPxXV
rbi5sz4omro3po2TmwWmsgwRQ1kTQKzKRGxdv+YyLjA8Wo95zTFQc8Hy7NNivJfF
8ZXKvcLzkzI8XPcrdOGiZ8v6brbwWYHqT3kdL+7ok8xTCwNVzrS1Vy7RWhnrpG2B
FfwgwXZGjlttZpGduhUHCxT2eJEzsxqBs/9N3Xvh6F65IrU9g0WWrcQvTWIVvG9/
fAnpQxTM9E/hlCU6fgHXCew8Ig29th36UpJYtHm9Fpykkj4/hmQ7enUqgOsP0p7o
TF7R8lLwAFKymivSZr0LMOMrOcGUOjX6vHVZcvKdjFSYYlXJ6C+CxO7fqBvEO/YY
adNGEQZyPcZVKTt5Fqvio20ff48mgltfbh2VUhC8K/pUy/Ox+hDNxU4Q/OIQyvAd
LaxdaUmZ1ID4WqtV1u3FxXc1s9nvjFQgi6sX/71YLk6YJzbli95Buq9jqfOLkK0X
d+x+L/K+NgfozHIurZvEJJwlXXH7HJibz2IB6ou/5We1/PKjHOBnLlk7EwBaqWLP
/oKFZ95m63xOWrDs+iQsCjn38hWkhKNzZ4+LxuRGh270gpdHsjmCzRZKj/jCfLJG
5cde7Rr5HJMWgwp77fcbRasnV7ZVj1C2Uh+i3cQwOMyKH0al5So5eGVdvQARAQAB
tCdKYXJ2aXMgKEJ1aWxkIFNlcnZlcikgPGphcnZpc0BjYWJ1Yi5tZT6JAk4EEwEK
ADgWIQR/APJ6s4X+GJ6dCjTn/TtkO9a+cgUCaGsJSAIbAwULCQgHAgYVCgkICwIE
FgIDAQIeAQIXgAAKCRDn/TtkO9a+ciShEACM802qwTw+7V1boUdTKtYCiAx7D9hu
+Tgjv5ajFTvdti8vsfkEXyVk2wsTV+98gFYDjv6UOEAUfKJEPwt0SCujfL5jdcy5
iqJoui+Jsqco4m/OgAkzyMjSp3w2l1bKwqhuzgMYWTREZYqXBoWBdnxmmUu/Fda8
/TFy+cOtbOSiZ59BXtKFsTGhNJDWPEKoz+tvN926Wkp/YqqF6aNyy9toN7ujo6sg
AFA/DUCTMT5+9hQUy0GDybRHcAg9VeNsUJjzK5gkYmq4FVnzHC9nwCm0AeOddIwl
e1KktAq2lpCYHrmJINn2tLLjBh9IMAALNLKdNejHzAUymtpcs5ztwG1jM/ZJEZQV
xRGEKsbHhgdOaFgnwqAix/8R0axNb7P/5YbTOJ+GBzNGq9rADOOWniKTSNhOyNZY
1UE2ABQlInnBKEu6iKl1Xo+FdBbtnQow1iQxZlG8IXQ+xjjrZ+oflRWOXWMn0KjR
rHymWYVItOhUfWGwS5t3YBY6XLr1J++mAbkjy24eq9IZ7wEEcYfQUODFX161S2Sv
CwHKmT5rjH/NOcT4Pasg99Mw1H7j8oKQi9AuPqXRGAco6g/4M2U3Cu6umdWNhDmJ
b4B2/+9fB0nS/IlAKpWPPIyiCa+u1iF3Ya6hAfkERbe6FLLLqdFy3VXQaNTHGhOT
sDDwLda2fHFje7kCDQRoawlIARAA3skw+7GVWdDSM9SZDJpW41azc4ERkyR/Q6Fi
xGZAvnDNAI1CZfQW2v28RzqGoaHAmK4cIr4BmeSGc9UhSaJWmLdzsVHECVDFrUMk
v3n0McyWJb3mp2vs1gahIb/veP8wIlBCTW4XQ8RdjsR+teS+5F+4QQ7Ihfgz8+Qo
QczdTQkbZNEMTbXisVbrHJ9qqBu+t0GkezYJueQLk86QthwIq1Bxbz2PRD2cBRbj
bY1rL4Zdy3janMReA/wnL9gOkwWukOFkUCffdv2RIJy/YIboyoQXSMWLpAk4mwn/
1Gl7nmENTvZHMP4LaJ1Jutz9l91tSJBUFFomecWf+ix5UU89IHCO+HIIu4D/O/PA
317AfgKdE/6ON4daMrLUQZSPNWogHeykoDh4h9RDxV1kmWr9EaMF2A7WvwInB6cg
qP4BWQN+CE43Z00YJOoa6l3bZYNEqERPnFC+MhODrdfnTWFt5dejrVsj7yM0u8q/
kD46QcAyPBHbBQM/CklOghqJAT1/VbR75GtzX1cOGAfqCJ7DEEXcXTzxkyT1E9o6
FHQghurqSCe4+OeHVAt1XiQwin8VitRms752J7siJPru3RBg0Pvh6pZNqdeDKbQk
766dF/RoXfy09WlXcGXr6nP8GuE0ORDqmhx8lbR3H7Otro4G/6Yrlr/y2akXCJWW
fDyvfckAEQEAAYkCNgQYAQoAIBYhBH8A8nqzhf4Ynp0KNOf9O2Q71r5yBQJoawlI
AhsMAAoJEOf9O2Q71r5yuJQQAKL/Fomj9uVnqJ6PoLsVgJ52jFtHOW39mPDdnnvA
S6LQjjUz5nBgcmyBtKNOLyUfD48aY3SjF9Hjb6TvfXzinwyWkmAaeuUq2XfyuJnS
PtU4kygHc+w0CzBhGbdzbLXNdJCS6CdBOceriLb5RBo3ksnPqazlIyNL468BMuMz
DtEz7Htm6OU60JsC5VxyjeUJ3LvOnnIn+Z2ko3WRs065i5FOXjEY9QDIsPeCOJhG
z3J89/ufpuijKLDLagmMmQdyIgT+nRoTcWvdkMxpJmIRHBS46fkrMNGYen1MkMUr
CJa544HkG+o/yz1dAysWsRytjiKDcaydjheBmcoZcGw7QBZjg4iZo1KmoDT1F0Vz
bpUGktpZudqU/4PdMS2kL3iKFq108Zg6k+yhIf9s+4lUND2Ta5sfvzMiEdGEOArH
nskwC9RX7ABSittI8biv7tqGgC/ohbZ2Zlr9R7noQ2MfUO8TRfNIStgQL1N60RLp
6Tp3QBETI6ma0iH02quNeGWP9jdLRrpdTEZYfGueE2+kajij72TlGlMOAbqAJT1a
u+1E+CxUJDfJuD9UYesyZPDafbEezTHIvtda79JFTpIPV8D8pGpHNW59T5coQtDR
j7JPLM225NlTocnmEuSlYtPgqx9z8BL/oJ0i42tHR/US9BSb717vMWDlfMRwi7tC
tjLH
=CnzL
-----END PGP PUBLIC KEY BLOCK-----
EOF

KEYID=$(gpg --show-keys "${KEYFILE}" | grep -A1 "pub" | tail -1 | tr -d ' ')
pacman-key --add "${KEYFILE}"
pacman-key --lsign-key "${KEYID}"

rm "${KEYFILE}"

cat >>/etc/pacman.conf <<EOF

[cabub.me]
SigLevel = Required
Server = http://jarvis.lab-1.cabub.me:8081/\$arch
EOF
